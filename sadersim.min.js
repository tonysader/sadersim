let tableItem;const tableItem_null={system_clients:[],system_event_type:null,server_status:null,num_in_queue:null,time_arrival:[],time_last_event:null,sim_time:null,event_list:[],num_delay:null,total_of_delays:null,area_queue:null,area_server:null};let table=[],rep={};const Q_LIMIT=100,BUSY=1,IDLE=0,end_on_time=1,end_on_cus=2,sim_type_manual=2,sim_type_random=1,event_type_arrival=1,event_type_departure=2,next_time_arrival=1,next_time_service=2;let next_event_type,num_custs_delayed,num_delays_required,num_events,num_in_q,server_status,area_num_in_q,area_server_status,mean_interarrival,mean_service,sim_time,time_last_event,total_of_delays,end_time,end_type,sim_type,errors=[],exit=!1,time_arrival=[],time_next=[],time_next_event=[],arrival_and_service_times=[],last_used_idx=[null,0,0];const expon=e=>-e*Math.log(lcgrand(1)),next_time=e=>{let t=1==e?arrival_and_service_times[last_used_idx[e]].arrival:arrival_and_service_times[last_used_idx[e]].service;return last_used_idx[e]++,t},initSim=()=>{server_status=0,num_in_q=0,time_last_event=0,sim_time=0,num_custs_delayed=0,total_of_delays=0,area_num_in_q=0,area_server_status=0,time_next_event=1===sim_type?[null,sim_time+expon(mean_interarrival),1e30]:[null,sim_time+next_time(1),1e30],1==end_type&&time_next_event.push(end_time)},timing=()=>{let e=99999999;next_event_type=0;for(let t=1;t<=num_events;t++)time_next_event[t]<e&&(e=time_next_event[t],next_event_type=t);0===next_event_type&&(errors.push(`Event list is empty at time ${sim_time}`),exit=!0),sim_time=e,tableItem.sim_time=sim_time,tableItem.system_event_type=next_event_type},update_time_avg_stats=()=>{let e=sim_time-time_last_event;time_last_event=sim_time,area_num_in_q+=num_in_q*e,area_server_status+=server_status*e,tableItem.time_last_event=time_last_event,tableItem.area_queue=area_num_in_q,tableItem.area_server=area_server_status},arrive=()=>{if(time_next_event[1]=1===sim_type?sim_time+expon(mean_interarrival):sim_time+next_time(1),1==server_status){++num_in_q>100&&(errors.push(`Overflow in the queue, sim_time:${sim_time}`),exit=!0),time_arrival[num_in_q]=sim_time,tableItem.num_in_queue=num_in_q;let e=JSON.parse(JSON.stringify(time_arrival));tableItem.time_arrival=e}else delay=0,total_of_delays+=delay,num_custs_delayed++,server_status=1,time_next_event[2]=1===sim_type?sim_time+expon(mean_service):sim_time+next_time(2),tableItem.total_of_delays=total_of_delays,tableItem.num_delay=num_custs_delayed,tableItem.server_status=server_status,tableItem.event_list[2]=time_next_event[2];tableItem.event_list[1]=time_next_event[1]},depart=()=>{if(0===num_in_q)server_status=0,time_next_event[2]=1e30,tableItem.server_status=server_status,tableItem.event_list[2]=time_next_event[2];else{num_in_q--,delay=sim_time-time_arrival[1],total_of_delays+=delay,num_custs_delayed++,time_next_event[2]=1===sim_type?sim_time+expon(mean_service):sim_time+next_time(2),console.log("time next event 2",time_next_event[2]);for(let e=1;e<=num_in_q;e++)time_arrival[e]=time_arrival[e+1];time_arrival.pop(),tableItem.num_in_queue=num_in_q,tableItem.total_of_delays=total_of_delays,tableItem.num_delay=num_custs_delayed,tableItem.event_list[2]=time_next_event[2];let e=JSON.parse(JSON.stringify(time_arrival));tableItem.time_arrival=e}},report=()=>{rep.average_delay_in_q=toDecimal(total_of_delays/num_custs_delayed),rep.average_num_in_q=toDecimal(area_num_in_q/sim_time),rep.average_server_util=toDecimal(area_server_status/sim_time),rep.time_end=toDecimal(sim_time)},simulation_start=({mean_i:e,mean_s:t,num_delays_req:_,e_type:a,e_time:i,arrival_services:n,s_type:s})=>{if(mean_interarrival=e,mean_service=t,num_delays_required=_,end_time=i,num_events=2==(end_type=a)?2:3,arrival_and_service_times=n,server_status=0,num_in_q=0,time_last_event=0,sim_time=0,num_custs_delayed=0,total_of_delays=0,area_num_in_q=0,area_server_status=0,time_next_event=1===(sim_type=s)?[null,sim_time+expon(mean_interarrival),1e30]:[null,sim_time+next_time(1),1e30],1==end_type&&time_next_event.push(end_time),2==end_type){for(;num_custs_delayed<num_delays_required;){switch(tableItem=tableItem_null,timing(),update_time_avg_stats(),next_event_type){case 1:arrive();break;case 2:depart()}console.log("tableItem",tableItem),console.log("table",table);let e=JSON.parse(JSON.stringify(tableItem));table.push(e)}report()}else do{switch(tableItem=tableItem_null,timing(),update_time_avg_stats(),next_event_type){case 1:arrive();break;case 2:depart();break;case 3:report()}let e=JSON.parse(JSON.stringify(tableItem));table.push(e)}while(3!=next_event_type)};function sasi(){return{startSim:(e,t)=>{simulation_start(e),t({rep:rep,errors:errors,table:table})}}}const MODLUS=2147483647,MULT1=24112,MULT2=26143;let zrng=[1,1973272912,281629770,20006270,1280689831,2096730329,1933576050,913566091,246780520,1363774876,604901985,1511192140,1259851944,824064364,150493284,242708531,75253171,1964472944,1202299975,233217322,1911216e3,726370533,403498145,993232223,1103205531,762430696,1922803170,1385516923,76271663,413682397,726466604,336157058,1432650381,1120463904,595778810,877722890,1046574445,68911991,2088367019,748545416,622401386,2122378830,640690903,1774806513,2132545692,2079249579,78130110,852776735,1187867272,1351423507,1645973084,1997049139,922510944,2045512870,898585771,243649545,1004818771,773686062,403188473,372279877,1901633463,498067494,2087759558,493157915,597104727,1530940798,1814496276,536444882,1663153658,855503735,67784357,1432404475,619691088,119025595,880802310,176192644,1116780070,277854671,1366580350,1142483975,2026948561,1053920743,786262391,1792203830,1494667770,1923011392,1433700034,1244184613,1147297105,539712780,1545929719,190641742,1645390429,264907697,620389253,1502074852,927711160,364849192,2049576050,638580085,547070247],lcgrand=e=>{let t,_,a;return(t=(65535&(_=24112*(65535&(t=zrng[e]))))-MODLUS+((32767&(a=24112*(t>>16)+(_>>16)))<<16)+(a>>15))<0&&(t+=MODLUS),(t=(65535&(_=26143*(65535&t)))-MODLUS+((32767&(a=26143*(t>>16)+(_>>16)))<<16)+(a>>15))<0&&(t+=MODLUS),zrng[e]=t,(t>>7|1)/16777216},toDecimal=(e,t=3)=>(Math.round(100*e)/100).toFixed(t);